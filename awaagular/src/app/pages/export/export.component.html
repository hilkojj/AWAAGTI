<div class="wrapper" fxLayout="row wrap">

    <div fxFlex="100%" class="config-save">

        <div fxLayout="row wrap">


            <mat-form-field fxFlex="100%" fxFlex.gt-sm="auto"
                appearance="outline">
                <mat-label>Config. name</mat-label>
                <input matInput placeholder="untitled"
                    [(ngModel)]="config.name">
            </mat-form-field>

            <button fxFlex="210px" mat-raised-button color="primary"
                fxHide.lt-md (click)="configs.saveConfig(config)">
                <mat-icon>save</mat-icon>
                Save configuration
            </button>

            <button fxFlex="100%" mat-raised-button color="primary"
                class="small" fxHide.gt-sm (click)="configs.saveConfig(config)">
                <mat-icon>save</mat-icon>
                Save configuration
            </button>
        </div>

    </div>

    <div class="map" fxFlex.gt-sm="50%" fxFlex.gt-md="66.6%"
        fxFlex="100%">
        <div id="map"></div>
    </div>

    <div class="stations" fxFlex.gt-sm="50%" fxFlex.gt-md="33.3%"
        fxFlex="100%">
        <mat-card>
            <h1 class="mat-h1">Stations</h1>

            {{config.stationIds.length}}
            {{config.stationIds.length == 1 ? 'station' :
            'stations'}} selected.

            <br>

            <mat-form-field appearance="outline"
                [style.width]="'100%'">
                <mat-label>Search for places</mat-label>
                <input matInput placeholder="e.g. Moscow or Iran"
                    [(ngModel)]="searchInput"
                    [matAutocomplete]="auto">
                <mat-icon matSuffix>search</mat-icon>

                <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let country of (searchInput == '' ? [] : countries).slice(0, 4)"
                        [value]="country.toLowerCase()"
                        (click)="focusOnCountry(country)">
                        <img class="flag" [src]="'/assets/flags/4x3/' + stations.countryCode(country)?.toLowerCase() + '.svg'">
                        <span class="name">
                            {{country.toLowerCase()}}
                        </span>
                    </mat-option>
                </mat-autocomplete>
            </mat-form-field>

            <div class="stations-tree">


                <div *ngFor="let country of countriesWithStations"
                    class="country">

                    <button mat-icon-button color="primary"
                        (click)="expanded[country] = !expanded[country]; expanded[country] && focusOnCountry(country)">

                        <mat-icon [style.transform]="expanded[country] ? 'rotate(90deg)' : ''">
                            keyboard_arrow_right
                        </mat-icon>
                    </button>

                    <span class="name">
                        {{country.toLowerCase()}}
                    </span>

                    <mat-checkbox [indeterminate]="countrySelected(country) == 1"
                        [checked]="countrySelected(country) == 2"
                        (change)="countrySelect(country, $event.checked)">
                    </mat-checkbox>

                    <mat-selection-list *ngIf="expanded[country]"
                        (selectionChange)="selectionChange($event.option)">
                        <mat-list-option *ngFor="let st of stationsByCountry(country)"
                            [value]="st.id" [selected]="config.stationIds.indexOf(st.id) != -1">

                            <span class="name">
                                {{st.name.toLowerCase()}}
                            </span>
                        </mat-list-option>
                    </mat-selection-list>
                </div>
            </div>

        </mat-card>
    </div>

    <div fxFlex.gt-sm="50%" fxFlex.gt-md="33.3%" fxFlex="100%">
        <mat-card>

            <h1 class="mat-h1">Time period</h1>

            <div fxLayout="row wrap" style="margin: 0 -8px -8px; padding: 0">


                <div fxFlex="100%" fxFlex.gt-sm="50%">
                    <div class="section time">

                        <span class="label">From:</span>
                        <mat-form-field>
                            <input matInput [matDatepicker]="picker"
                                [(ngModel)]="fromDate"
                                (dateChange)="dateChanged()"
                                placeholder="Choose a date">
                            <mat-datepicker-toggle
                                matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>


                        <mat-form-field>
                            <input matInput placeholder="Time"
                                [(ngModel)]="fromTime">
                        </mat-form-field>

                    </div>
                </div>

                <div fxFlex="100%" fxFlex.gt-sm="50%">
                    <div class="section time">
                        <span class="label">To:</span>
                        <mat-form-field [class.disabled]="config.timeFrame.to == -1">
                            <input matInput [matDatepicker]="toPicker"
                                [(ngModel)]="toDate"
                                (dateChange)="dateChanged()"
                                placeholder="Choose a date">
                            <mat-datepicker-toggle
                                matSuffix [for]="toPicker"></mat-datepicker-toggle>
                            <mat-datepicker #toPicker></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field>
                            <input matInput placeholder="Time"
                                [disabled]="config.timeFrame.to == -1"
                                [(ngModel)]="toTime">
                        </mat-form-field>

                        <mat-checkbox (change)="setToTime($event.checked)"
                            [checked]="config.timeFrame.to == -1">
                            Current time
                        </mat-checkbox>
                    </div>
                </div>

                <div fxFlex="100%">
                    <div class="section">

                        <span class="label">Interval:</span>

                        <mat-form-field>
                            <mat-select [(ngModel)]="config.timeFrame.interval">
                                <mat-option [value]="1">
                                    1 second
                                </mat-option>
                                <mat-option [value]="60">
                                    1 minute
                                </mat-option>
                                <mat-option [value]="3600">
                                    1 hour
                                </mat-option>
                                <mat-option [value]="86400">
                                    1 day
                                </mat-option>
                                <mat-option [value]="2592000">
                                    1 month
                                </mat-option>
                            </mat-select>
                        </mat-form-field>

                    </div>
                </div>
            </div>
        </mat-card>
    </div>

    <div fxFlex.gt-sm="50%" fxFlex.gt-md="33.3%" fxFlex="100%">
        <mat-card>
            <h1 class="mat-h1">Export</h1>

            <div *ngFor="let m of configs.measurements">
                <mat-checkbox [checked]="config.what.includes(m)"
                    (change)="measurementSelect($event.checked, m)">
                    {{m | decamelcase}}
                </mat-checkbox>
            </div>

            <mat-form-field>
                <mat-select placeholder="Sort by"
                    [(ngModel)]="config.sortBy">
                    <mat-option [value]="null">
                        Don't sort
                    </mat-option>
                    <mat-option *ngFor="let m of configs.measurements"
                        [value]="m">
                        {{m | decamelcase}}
                    </mat-option>

                </mat-select>

            </mat-form-field>
            <br>
            <mat-form-field>
                <input matInput placeholder="Limit"
                    [(ngModel)]="config.limit" type="number">
            </mat-form-field>

            <br>

            <button mat-raised-button color="primary"
                (click)="configs.exportConfig(config)">
                <mat-icon style="margin-right: 8px; vertical-align: sub">save_alt</mat-icon>
                Get data
            </button>

        </mat-card>
    </div>

</div>